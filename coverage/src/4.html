<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\pierc\source\repos\RGBDS2CIL\RGBDS2CIL\CSharp\Macro.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System.Collections.Generic;
using System.Globalization;
using System.Linq;
using System.Text;

namespace RGBDS2CIL
{
	public static class Macro
	{
		internal static int ProcessMacro(StringBuilder sb, int tabCount, MacroLine macroLine)
		{
			var ti = CultureInfo.CurrentCulture.TextInfo;
			var privatePublic = &quot;&quot;;//macroLine.IsLocal ? &quot;private &quot; : &quot;public &quot;;
			var methodName = ti.ToTitleCase(macroLine.Name.Trim(&#39;:&#39;));

			var argCount = 0;
			var linesToUpdate = new List&lt;IAsmLine&gt;();
			foreach (var macroLineLine in macroLine.Lines.OfType&lt;CodeLine&gt;())
			{
				argCount = ReplaceArgs(macroLineLine, argCount, linesToUpdate);
				if (macroLineLine is IfLine ifLine)
					foreach (var ifLineLine in ifLine.Lines)
					{
						argCount = ReplaceArgs(ifLineLine, argCount, linesToUpdate);
					}


			}

			if (!string.IsNullOrWhiteSpace(macroLine.Comment))
			{
				sb.Append(new string(&#39;\t&#39;, tabCount)).AppendLine(&quot;/// &lt;summary&gt;&quot;);
				sb.Append(new string(&#39;\t&#39;, tabCount)).Append(&quot;/// &quot;).AppendLine(macroLine.Comment);
				sb.Append(new string(&#39;\t&#39;, tabCount)).AppendLine(&quot;/// &lt;/summary&gt;&quot;);
				for (var i = 0; i &lt; argCount; i++)
				{
					sb.Append(new string(&#39;\t&#39;, tabCount)).Append(&quot;/// &lt;param name=\&quot;args[&quot;).Append(i).AppendLine(&quot;]\&quot;&gt;&lt;/param&gt;&quot;);
				}
				sb.Append(new string(&#39;\t&#39;, tabCount)).AppendLine(&quot;/// &lt;returns&gt;&lt;/returns&gt;&quot;);
			}

			sb.Append(new string(&#39;\t&#39;, tabCount)).Append(privatePublic).Append(&quot;void &quot;).Append(methodName);

			sb.AppendLine(argCount == 0 ? &quot;()&quot; : &quot;(params object[] args)&quot;);

			sb.Append(new string(&#39;\t&#39;, tabCount)).AppendLine(&quot;{&quot;);
			tabCount++;
			foreach (var macroLineLine in macroLine.Lines)
			{
				var lineLine = macroLineLine.Reparse();
				CSharp.OutputCSharp(lineLine, sb, tabCount);
			}

			tabCount--;
			return tabCount;
		}

		private static int ReplaceArgs(IAsmLine macroLineLine, int argCount, List&lt;IAsmLine&gt; linesToUpdate)
		{
			var lineLine = macroLineLine.Reparse() as CodeLine;
			for (var i = 1; i &lt; 10; i++)
			{
				if (!lineLine.Code.Contains($&quot;\\{i}&quot;)) continue;
				argCount = i;
				lineLine.Code = lineLine.Code.Replace($&quot;\\{i}&quot;, $&quot;args[{i - 1}]&quot;);
				if (macroLineLine is ConstantLine constantLine)
				{
					constantLine.ConstantValue = constantLine.ConstantValue.Replace($&quot;\\{i}&quot;, $&quot;args[{i - 1}]&quot;);
					constantLine.ConstantName = constantLine.ConstantName.Replace($&quot;\\{i}&quot;, $&quot;args[{i - 1}]&quot;);
					lineLine = constantLine;
				}

				linesToUpdate.Add(lineLine);
			}

			return argCount;
		}
	}
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[11,3,11,4,1],[12,4,12,49,1],[13,4,13,27,1],[14,4,14,62,1],[16,4,16,21,1],[17,4,17,45,1],[18,4,18,11,1],[18,13,18,30,0],[18,31,18,33,1],[18,34,18,68,1],[19,4,19,5,0],[20,5,20,68,0],[21,5,21,40,0],[22,6,22,13,0],[22,15,22,29,0],[22,30,22,32,0],[22,33,22,45,0],[23,6,23,7,0],[24,7,24,67,0],[25,6,25,7,0],[28,4,28,5,0],[30,4,30,54,1],[31,4,31,5,0],[32,5,32,71,0],[33,5,33,88,0],[34,5,34,72,0],[35,10,35,19,0],[35,21,35,33,0],[35,35,35,38,0],[36,5,36,6,0],[37,6,37,115,0],[38,5,38,6,0],[39,5,39,81,0],[40,4,40,5,0],[42,4,42,99,1],[44,4,44,67,1],[46,4,46,58,1],[47,4,47,15,1],[48,4,48,11,1],[48,13,48,30,0],[48,31,48,33,1],[48,34,48,49,1],[49,4,49,5,0],[50,5,50,44,0],[51,5,51,49,0],[52,4,52,5,0],[54,4,54,15,1],[55,4,55,20,1],[56,3,56,4,1],[59,3,59,4,0],[60,4,60,55,0],[61,9,61,18,0],[61,20,61,26,0],[61,28,61,31,0],[62,4,62,5,0],[63,5,63,43,0],[63,44,63,53,0],[64,5,64,18,0],[65,5,65,71,0],[66,5,66,52,0],[67,5,67,6,0],[68,6,68,98,0],[69,6,69,96,0],[70,6,70,30,0],[71,5,71,6,0],[73,5,73,33,0],[74,4,74,5,0],[76,4,76,20,0],[77,3,77,4,0]]);
    </script>
  </body>
</html>